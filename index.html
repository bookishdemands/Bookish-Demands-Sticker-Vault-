<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bookish Demands Sticker Vault — Full (Nova/Nyx)</title>

  <style>
    :root{
      --bg:#0f0f14;
      --panel: rgba(255,255,255,.04);
      --line: rgba(255,255,255,.10);
      --text:#f3f3f7;
      --muted:#a9a9b7;
      --accent:#ff4fa3;
      --shadow: 0 12px 34px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 500px at 10% 0%, rgba(255,79,163,.18), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(32,227,178,.14), transparent 55%),
        radial-gradient(900px 500px at 40% 110%, rgba(255,205,115,.10), transparent 55%),
        var(--bg);
    }
    .wrap{max-width:1240px;margin:0 auto;padding:24px 16px 60px}
    header{display:flex;flex-wrap:wrap;align-items:flex-end;justify-content:space-between;gap:14px;margin-bottom:16px}
    h1{margin:0;font-size:clamp(22px,3.2vw,34px);letter-spacing:.2px}
    .subtitle{color:var(--muted);line-height:1.35;max-width:100ch;margin-top:6px}
    .grid{display:grid;grid-template-columns:1.08fr .92fr;gap:16px;margin-top:18px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .cardHead{padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.07);display:flex;align-items:center;justify-content:space-between;gap:10px}
    .cardHead h2{margin:0;font-size:14px;letter-spacing:.6px;text-transform:uppercase;color:rgba(243,243,247,.9)}
    .mini{
      font-family:var(--mono);
      font-size:11.5px;
      color:rgba(243,243,247,.85);
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      border-radius:999px;padding:6px 10px;white-space:nowrap
    }
    .cardBody{padding:14px 16px 16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
    @media (max-width:560px){.row{grid-template-columns:1fr}}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    select,input[type="text"],textarea{
      width:100%;padding:10px 11px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.25);color:var(--text);outline:none
    }
    textarea{min-height:118px;font-family:var(--mono);font-size:12.5px;line-height:1.35;resize:vertical}
    .toggle{
      display:flex;align-items:flex-start;gap:10px;padding:10px 11px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.18);color:var(--muted);user-select:none
    }
    .toggle input{width:18px;height:18px;margin-top:2px}
    .buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{
      border:0;border-radius:999px;padding:11px 14px;font-weight:900;letter-spacing:.15px;cursor:pointer;
      color:#0f0f14;background:linear-gradient(135deg,var(--accent),#ffcc73);box-shadow:0 10px 25px rgba(255,79,163,.18)
    }
    button.secondary{background:rgba(255,255,255,.08);color:var(--text);border:1px solid rgba(255,255,255,.12);box-shadow:none}
    button.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18);box-shadow:none}
    button:active{transform:translateY(1px)}
    .divider{height:1px;background:rgba(255,255,255,.08);margin:14px 0}
    .hint{color:var(--muted);font-size:12px;line-height:1.45;margin-top:8px}
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:rgba(20,20,30,.92);border:1px solid rgba(255,255,255,.12);color:var(--text);
      padding:10px 12px;border-radius:999px;font-size:12px;opacity:0;pointer-events:none;
      transition:opacity .18s ease;box-shadow:var(--shadow);max-width:calc(100vw - 24px);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;z-index:9999
    }
    .toast.show{opacity:1}
    .bankGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){.bankGrid{grid-template-columns:1fr}}
    .bankBox{padding:10px 11px;border:1px solid var(--line);border-radius:14px;background:rgba(0,0,0,.16)}
    .bankTitle{font-size:12px;color:rgba(243,243,247,.9);font-weight:900;letter-spacing:.5px;margin-bottom:8px}
    .checkRow{display:flex;gap:10px;align-items:flex-start;color:var(--muted);padding:6px 0}
    .checkRow input{width:18px;height:18px;margin-top:2px}
    .footerNote{margin-top:14px;color:var(--muted);font-size:12px;line-height:1.5}
    .footerNote b{color:var(--text)}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Bookish Demands Sticker Vault</h1>
        <div class="subtitle">
          Full sticker prompt engine built around your aesthetic: <b>urban bookish</b>, <b>dark romance (non-graphic)</b>, <b>black romance</b>, <b>black paranormal</b>, <b>thriller</b>, <b>fantasy</b>, <b>horror</b>.
          Includes <b>new product themes</b>, <b>tropes</b>, <b>mood/IYKYK quotes</b>, <b>hand-drawn preset</b>, <b>horror palette harmony</b>, and <b>strict cut-safe containment for ALL accents</b>.
        </div>
      </div>
      <div class="mini" id="statusPill">Ready</div>
    </header>

    <div class="grid">
      <!-- INPUTS -->
      <section class="card">
        <div class="cardHead">
          <h2>Inputs</h2>
          <span class="mini">Random picks: 1–2 banks max ✅</span>
        </div>
        <div class="cardBody">

          <div class="row">
            <div>
              <label for="count">How many prompts?</label>
              <select id="count">
                <option value="1">1</option><option value="2">2</option><option value="3" selected>3</option><option value="4">4</option><option value="5">5</option>
              </select>
            </div>
            <div>
              <label for="stickerType">Sticker Type</label>
              <select id="stickerType">
                <option value="packaging" selected>Packaging Label Sticker</option>
                <option value="icon_quote">Icon + Quote</option>
                <option value="icon_only">Icon Only (no text)</option>
                <option value="quote_only">Quote Only (typography sticker)</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="genreTone">Genre Tone</label>
              <select id="genreTone">
                <option value="">None</option>
                <option value="urban_fiction">Urban Fiction</option>
                <option value="dark_romance">Dark Romance (non-graphic)</option>
                <option value="black_paranormal">Black Paranormal Romance</option>
                <option value="black_romance">Black Romance</option>
                <option value="thriller">Thriller</option>
                <option value="fantasy">Fantasy</option>
                <option value="horror">Horror</option>
                <option value="soft_glam_reader">Soft Glam Reader</option>
                <option value="bookish_luxe">Bookish Luxe</option>
              </select>
            </div>
            <div>
              <label for="variation">Variation / Style</label>
              <select id="variation">
                <option value="">None</option>
                <option value="booktok_pop">BookTok Pop-Art</option>
                <option value="bold_vector">Bold Vector Sticker</option>
                <option value="cute_clipart">Cute Flat Clipart</option>
                <option value="hand_doodle">Hand-Doodle Charm</option>
                <option value="hand_drawn">Hand-Drawn (Ink Sketch) ✅</option>
                <option value="noir_minimal">Noir Minimal</option>
                <option value="neon_noir">Neon Noir</option>
                <option value="luxury_editorial">Luxury Editorial</option>
                <option value="vintage_label">Vintage Apothecary Label</option>
                <option value="kawaii_goth">Kawaii Goth</option>
              </select>
            </div>
          </div>

          <div class="row">
            <label class="toggle" style="grid-column:1/-1;">
              <input id="handDrawnPreset" type="checkbox" />
              <div><b>Hand-Drawn preset toggle</b> (forces Hand-Drawn variation + keeps sticker-ready clarity)</div>
            </label>
          </div>

          <div class="row">
            <div>
              <label for="vibe">Vibe / Mood</label>
              <select id="vibe">
                <option value="">None</option>
                <option>Street Luxe Romance</option>
                <option>Morally Gray Glam</option>
                <option>Kindle After Dark</option>
                <option>Booktrovert Peace Mode</option>
                <option>Protective Possessive Energy</option>
                <option>Jealous Enemy Plot</option>
                <option>Forbidden Attraction</option>
                <option>Witchy City Glam</option>
                <option>Coven Chic</option>
                <option>Luxury Reader Baddie</option>
                <option>Intellectual Villain Era</option>
                <option>Soft Life But Savage</option>

                <option>Mood: quotes</option>
                <option>IYKYK</option>
                <option>Audiobook quotes</option>
                <option>This book ruined me… 5 stars</option>
                <option>Remaining in Bookland until further notice</option>
                <option>Slow burn</option>
                <option>In my “___” era</option>
                <option>DBE: ___ … 5 stars</option>
                <option>Ugly cry</option>
                <option>STFUATTDLAGG</option>
              </select>
            </div>
            <div>
              <label for="productTheme">Product Theme (new expanded list)</label>
              <select id="productTheme">
                <option value="">None</option>

                <!-- Medical / label-core -->
                <option value="iv_bag">IV Bag</option>
                <option value="pill_bottle">Prescription Bottle + Warning Label</option>
                <option value="prescription_pad">Prescription Pad</option>
                <option value="heart_monitor">Heartbeat Monitor Screen / Strip</option>
                <option value="toe_tag">Toe Tag (clean thriller-coded)</option>
                <option value="specimen_vial">Lab Specimen Vial (sparkly evidence)</option>
                <option value="evidence_tag">Evidence Tag + Barcode</option>
                <option value="bp_monitor">Blood Pressure Monitor</option>

                <!-- Receipts / slips / cards -->
                <option value="library_card">Library Card / Checkout Slip</option>
                <option value="guest_check">Guest Check</option>
                <option value="tbr_receipt">TBR Receipt (store receipt aesthetic)</option>
                <option value="book_review_card">Book Review Card (5 stars)</option>
                <option value="name_tag">Name Tag (Hello, I am…)</option>
                <option value="door_tag">Door Tag (Do Not Disturb)</option>
                <option value="confession_note">Confession Note (“Confession: …”)</option>
                <option value="sticky_memos">Sticky Memos</option>

                <!-- Scales / meters -->
                <option value="spice_scale">Spice Scale (thermometer/meter)</option>
                <option value="delulu_meter">Delulu Meter</option>
                <option value="caution_sign">Caution Sign (spice/delulu warning)</option>

                <!-- Witchy / luxe -->
                <option value="elixir">Elixir / Love potion dropper bottle</option>
                <option value="candle_jar">Candle jar / spell candle</option>
                <option value="wax_seal">Wax seal stamp kit</option>
                <option value="tarot_pack">Tarot card pack (original)</option>
                <option value="fortune_cookie">Fortune cookie</option>
                <option value="magic_8_ball">Magic 8 ball</option>
                <option value="glass_fortune_ball">Glass fortune ball</option>

                <!-- Lifestyle / cute -->
                <option value="matchbook">Matchbook / matchbox (“Ignite me” / “Burn after reading”)</option>
                <option value="polaroid_frame">Polaroid photo frame</option>
                <option value="nail_polish">Nail polish bottle</option>
                <option value="coffee_cup">Coffee / iced coffee / tea cup</option>
                <option value="bookmark_sneaker_lace">Bookmark + sneaker lace combo</option>
                <option value="book_stack">Stack of books (tropes on spines)</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="palette">Color Palette</label>
              <select id="palette"></select>
            </div>
            <div>
              <label for="bgMode">Background</label>
              <select id="bgMode">
                <option value="transparent" selected>Transparent background</option>
                <option value="solid_white">Solid white background</option>
                <option value="none_specified">Don’t specify</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="border">Sticker Border</label>
              <select id="border">
                <option value="white" selected>White border (recommended)</option>
                <option value="none">No border</option>
              </select>
            </div>
            <div>
              <label for="outline">Outline</label>
              <select id="outline">
                <option value="bold_black" selected>Thick bold outline</option>
                <option value="no_outline">No outline</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="spiceLevel">Spice Level (non-graphic)</label>
              <select id="spiceLevel">
                <option value="1">1 — sweet tension</option>
                <option value="2" selected>2 — playful heat</option>
                <option value="3">3 — spicy vibes</option>
                <option value="4">4 — dark romance heat</option>
                <option value="5">5 — filthy talk energy</option>
              </select>
            </div>
            <div>
              <label for="typoRule">Typography Rules</label>
              <select id="typoRule">
                <option value="on" selected>Enforce: clear legible typography</option>
                <option value="off">Don’t specify typography rules</option>
              </select>
            </div>
          </div>

          <div class="row">
            <label class="toggle" style="grid-column:1/-1;">
              <input id="blankMode" type="checkbox" />
              <div><b>Blank sticker mode</b> (no text at all)</div>
            </label>
          </div>

          <div class="row">
            <label class="toggle" style="grid-column:1/-1;">
              <input id="cutSafeMode" type="checkbox" checked />
              <div><b>Cut-safe mode</b> (forces ALL accents/particles/glow inside the die-cut silhouette — ON by default)</div>
            </label>
          </div>

          <div class="row">
            <div>
              <label for="labelMode">Label Text Mode</label>
              <select id="labelMode">
                <option value="none">No label text</option>
                <option value="auto" selected>Auto title + subtitle</option>
                <option value="manual">Use my Title + Subtitle</option>
                <option value="mixed">Manual if provided, else Auto</option>
                <option value="quote_subtitle">Quote as Subtitle (title auto)</option>
              </select>
            </div>
            <div>
              <label for="quoteMode">Quote Length</label>
              <select id="quoteMode">
                <option value="any" selected>Any</option>
                <option value="micro">Micro (2–6 words)</option>
                <option value="standard">Standard (one-liners)</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="titleText">Title (optional)</label>
              <input id="titleText" type="text" maxlength="60" placeholder='Example: "GUEST CHECK"' />
            </div>
            <div>
              <label for="subtitleText">Subtitle (optional)</label>
              <input id="subtitleText" type="text" maxlength="90" placeholder='Example: "Call me a good girl and take me to the bookstore"' />
            </div>
          </div>

          <div class="row">
            <label class="toggle" style="grid-column:1/-1;">
              <input id="useRandomQuote" type="checkbox" checked />
              <div><b>Use random quote</b> (type one to override)</div>
            </label>
          </div>

          <div class="row">
            <div>
              <label for="quote">Quote override (optional)</label>
              <input id="quote" type="text" maxlength="160" placeholder='Example: "This book ruined me… 5 stars."' />
            </div>
            <div>
              <label for="quoteUsage">Quote usage</label>
              <select id="quoteUsage">
                <option value="smart" selected>Smart (depends on sticker type)</option>
                <option value="always">Always include quote (if not blank)</option>
                <option value="never">Never include quote line</option>
              </select>
            </div>
          </div>

          <div class="divider"></div>

          <div class="row">
            <div>
              <label for="customMainObject">Custom Main Object (optional)</label>
              <input id="customMainObject" type="text" maxlength="140" placeholder='Example: "sparkly Kindle + sneaker charm"' />
            </div>
            <div>
              <label for="customVibe">Custom Vibe (optional)</label>
              <input id="customVibe" type="text" maxlength="140" placeholder='Example: "Remaining in Bookland until further notice"' />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="customPalette">Custom Palette (optional)</label>
              <input id="customPalette" type="text" maxlength="140" placeholder='Example: "red + black + chrome"' />
            </div>
            <div>
              <label for="customAccents">Custom Accents (optional)</label>
              <input id="customAccents" type="text" maxlength="140" placeholder='Example: "gold foil flecks + glitter dots (inside border)"' />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="customProductTheme">Custom Product Theme (optional)</label>
              <input id="customProductTheme" type="text" maxlength="160" placeholder='Example: "caution sign sticker about spice levels"' />
            </div>
            <div>
              <label for="customQuotes">Custom Quote Bank (optional — one per line)</label>
              <textarea id="customQuotes" placeholder="Add your own quotes here. If filled, random quotes pull from here first."></textarea>
            </div>
          </div>

          <div class="divider"></div>

          <div class="bankGrid">
            <div class="bankBox">
              <div class="bankTitle">CORE BANKS (Random picks 1–2 max)</div>

              <label class="checkRow"><input type="checkbox" id="bGeneralUrbanBookish" checked><span>General Urban Bookish</span></label>
              <label class="checkRow"><input type="checkbox" id="bTBRKindleBooktok"><span>TBR / Kindle / BookTok</span></label>
              <label class="checkRow"><input type="checkbox" id="bMorallyGray"><span>Morally Gray / DBE / Villain Era</span></label>
              <label class="checkRow"><input type="checkbox" id="bUnhingedMMC"><span>Unhinged MMC (protective/possessive)</span></label>
              <label class="checkRow"><input type="checkbox" id="bStreetLingo"><span>Street / Urban Lingo</span></label>
              <label class="checkRow"><input type="checkbox" id="bTropes"><span>BookTok Tropes (wealthy MMC, age-gap, reverse harem, etc.)</span></label>
              <label class="checkRow"><input type="checkbox" id="bMoodIYKYK"><span>Mood / IYKYK / Era / Bookland</span></label>
            </div>

            <div class="bankBox">
              <div class="bankTitle">GENRE BANKS (Random picks 1–2 max)</div>

              <label class="checkRow"><input type="checkbox" id="gUrbanFiction"><span>Urban Fiction</span></label>
              <label class="checkRow"><input type="checkbox" id="gBlackRomance"><span>Black Romance</span></label>
              <label class="checkRow"><input type="checkbox" id="gDarkRomance"><span>Dark Romance (non-graphic)</span></label>
              <label class="checkRow"><input type="checkbox" id="gBlackParanormal"><span>Black Paranormal Romance</span></label>
              <label class="checkRow"><input type="checkbox" id="gThriller"><span>Thriller / Suspense</span></label>
              <label class="checkRow"><input type="checkbox" id="gFantasy"><span>Fantasy</span></label>
              <label class="checkRow"><input type="checkbox" id="gHorror"><span>Horror</span></label>
              <label class="checkRow"><input type="checkbox" id="gSoftGlam"><span>Soft Glam Reader</span></label>
              <label class="checkRow"><input type="checkbox" id="gBookishLuxe"><span>Bookish Luxe</span></label>
            </div>
          </div>

          <div class="buttons">
            <button id="generateBtn">Generate</button>
            <button class="secondary" id="copyBtn">Copy Prompt</button>
            <button class="ghost" id="randomBtn">Randomize</button>
            <button class="ghost" id="clearBtn">Clear All</button>
          </div>

          <div class="hint">
            <b>Important:</b> Cut-safe mode adds strict “no sparkles/particles outside outline” rules that apply to <b>ALL accents</b>.
            <br><b>Harmony:</b> If Genre Tone is <b>Horror</b> and palette is blank, it will auto-pair to <b>red/black</b> palettes.
          </div>
        </div>
      </section>

      <!-- OUTPUTS -->
      <section class="card">
        <div class="cardHead">
          <h2>Outputs</h2>
          <span class="mini">Ideogram-ready ✅</span>
        </div>
        <div class="cardBody">
          <div style="margin-bottom:12px;">
            <label for="promptOut">Prompt</label>
            <textarea id="promptOut" readonly></textarea>
          </div>
          <div style="margin-bottom:12px;">
            <label for="negOut">Negative Prompt</label>
            <textarea id="negOut" readonly></textarea>
          </div>
          <div>
            <label for="notesOut">Export Notes</label>
            <textarea id="notesOut" readonly></textarea>
          </div>
          <div class="footerNote">
            <b>Commercial safety:</b> keep it original — avoid brand names/logos, real book titles, celebrity likeness, and copyrighted characters.
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast">Copied!</div>

  <script>
    // ---------- helpers ----------
    const $ = (id)=>document.getElementById(id);
    const v = (id)=>($(id)?.value ?? "");
    const setV = (id,val)=>{ if($(id)) $(id).value = val; };
    const c = (id)=>!!($(id)?.checked);
    const setC = (id,val)=>{ if($(id)) $(id).checked = !!val; };
    const rndInt = (n)=>Math.floor(Math.random()*n);
    const pick = (arr)=>arr[rndInt(arr.length)];
    const uniq = (arr)=>Array.from(new Set(arr));

    function showToast(msg){
      const t = $("toast");
      if(!t) return;
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1100);
    }
    function setStatus(msg){
      const p = $("statusPill");
      if(p) p.textContent = msg;
    }

    // ---------- variations ----------
    const VARIATIONS = {
      booktok_pop: "booktok pop-art sticker style, bold shapes, punchy contrast, crisp outlines",
      bold_vector: "bold vector sticker, thick clean lines, high-contrast shapes, sharp vector clarity",
      cute_clipart: "cute flat vector clipart sticker, rounded shapes, clean flat shading, crisp edges, commercial clipart look",
      hand_doodle: "hand-drawn doodle sticker style, thick outline, simple flat shading, charming imperfections (but clean)",
      hand_drawn: "hand-drawn illustration style, ink sketch outlines, slightly imperfect strokes, cute + edgy, still crisp and sticker-ready, vector-like clarity",
      noir_minimal: "noir minimal sticker, simple shapes, limited details, strong contrast, modern minimal icon",
      neon_noir: "neon noir sticker, subtle neon glow accents (glow contained inside silhouette), dark subject, high contrast highlights",
      luxury_editorial: "luxury editorial sticker aesthetic, polished highlights, premium glam details, clean upscale feel",
      vintage_label: "vintage apothecary label sticker style, ornate frame details, clean label blocks, readable type",
      kawaii_goth: "kawaii goth sticker style, cute + dark contrast, tiny spooky accents, clean vector finish"
    };

    // ---------- palettes ----------
    const PALETTES = [
      "Grey + Red + Black",
      "Black Cherry + Gunmetal + Chrome",
      "Blood Red + Ink Black + Steel",
      "Obsidian + Molten Gold + Smoke Gray",
      "Deep Plum + Rose Gold + Charcoal",
      "Burgundy Wine + Antique Gold + Espresso",
      "White + Black + Chrome",
      "Ivory + Espresso + Rose Gold",
      "Blush Pink + Cocoa + Cream",
      "Rose Gold + Mauve + Champagne",
      "Neon Pink + Black + Chrome",
      "Forest Green + Black + Moonlight Silver",
      "Midnight Blue + Emerald + Gold",
      "Amethyst + Midnight + Silver"
    ];
    const HORROR_PALETTES = [
      "Grey + Red + Black",
      "Blood Red + Ink Black + Steel",
      "Black Cherry + Gunmetal + Chrome",
      "White + Black + Chrome"
    ];

    function loadPalettes(){
      const sel = $("palette");
      sel.innerHTML = "";
      const opt0 = document.createElement("option");
      opt0.value = "";
      opt0.textContent = "None";
      sel.appendChild(opt0);
      PALETTES.forEach(p=>{
        const o=document.createElement("option");
        o.value=p; o.textContent=p;
        sel.appendChild(o);
      });
    }

    // ---------- product descriptions (ALL new additions included) ----------
    const PRODUCT_DESC = {
      // Medical / thriller / lab
      iv_bag: "IV drip bag sticker illustration (generic medical bag shape), hanging with tube, clamp, drip chamber, glossy liquid fill; clean label panel area for text; no hospital branding",
      pill_bottle: "prescription bottle sticker (non-IV), amber bottle with childproof cap, clean warning label panel; a few stylized pills; no pharmacy branding",
      prescription_pad: "prescription pad / Rx notepad sticker with tear-off sheets and clean header blocks; no clinic branding",
      heart_monitor: "heart monitor screen or ECG strip sticker with waveform, clean monitor frame, readable label panel; no device branding",
      toe_tag: "toe tag / evidence tag cousin sticker with string loop and bold label blocks; thriller-coded but cute/clean; no real case identifiers",
      specimen_vial: "lab specimen vial sticker with barcode label and sparkly 'evidence' inside; clean lab aesthetic; no branding",
      evidence_tag: "evidence tag sticker with barcode and neat fields; cute thriller vibe; no real case identifiers",
      bp_monitor: "blood pressure monitor sticker with cuff icon and a clean digital display for humorous bookish stats; no branding",

      // Slips / receipts / cards
      library_card: "library card / checkout slip sticker with due-date stamp areas, barcode, and neat fields; vintage checkout aesthetic; no real library branding",
      guest_check: "guest check sticker (restaurant-style form) with grid lines and header fields; big bold handwritten quote area; no real restaurant branding",
      tbr_receipt: "store receipt sticker titled 'TBR RECEIPT' with itemized tropes/reads list, subtotal/total lines, barcode, funny footer; no real store branding",
      book_review_card: "book review card sticker with star row and a short review line like '...5 stars'; clean readable layout",
      name_tag: "name tag sticker 'HELLO, I AM…' with big name field and optional subtitle; clean label blocks; no branding",
      door_tag: "door hanger / do-not-disturb sticker with bold header and quote area; clean signage layout; no branding",
      confession_note: "confession note sticker with header 'CONFESSION:' and a bold handwritten quote; cute dramatic vibe; clean paper edges",
      sticky_memos: "sticky memo pad sticker with handwritten quote, tape corners or tab, doodle accents; high contrast, readable",

      // Scales / meters / signs
      spice_scale: "spice scale meter sticker (thermometer or slider) with labeled levels; playful icons; clean readable sections",
      delulu_meter: "delulu meter sticker with labeled levels and a slider indicator; cute + cocky vibe",
      caution_sign: "caution sign / warning placard sticker related to spice level or delulu choices; bold readable header; clean signage style",

      // Witchy / fortune / tools
      elixir: "love potion / elixir dropper bottle sticker with label panel and sparkly fill; coven chic vibe; no branding",
      candle_jar: "candle jar / spell candle sticker with label panel; tiny sparkles and glow strictly contained inside silhouette; no branding",
      wax_seal: "wax seal stamp kit sticker: wax seal imprint, stamp handle, sealing wax; elegant label area; no branding",
      tarot_pack: "original tarot card pack sticker (not a copyrighted deck) with ornate frame and symbolic icon; readable title block",
      fortune_cookie: "fortune cookie sticker with a fortune strip showing a short quote; clean cute style",
      magic_8_ball: "magic 8 ball sticker with readable answer window; glossy highlight; clean silhouette",
      glass_fortune_ball: "glass fortune ball sticker on a small stand; faint glow fully contained inside silhouette; mystical vibe",

      // Lifestyle / cute
      matchbook: "matchbook / matchbox sticker with bold headline and short quote; matchstick icons; clean vintage pop look",
      polaroid_frame: "polaroid photo frame sticker with blank photo area and caption strip; clean border; no branding",
      nail_polish: "nail polish bottle sticker with glossy highlight, label panel, tiny sparkles; no branding",
      coffee_cup: "coffee / iced coffee / tea cup sticker with lid and optional straw; condensation highlights; label panel; no branding",
      bookmark_sneaker_lace: "bookmark + sneaker lace combo sticker: cute bookmark tag paired with a stylized sneaker lace loop/bow; bookish + streetwear mashup; crisp outlines",
      book_stack: "stack of books sticker with trope names on the spines (bold readable typography), cute accents, clean outlines; no real titles/authors"
    };

    const PRODUCT_LABEL_TITLE_BANK = {
      guest_check: ["GUEST CHECK","BOOKSTORE DATE CHECK","TAB: BOOKS + CHEMISTRY","CHECK, PLEASE (TO THE BOOKSTORE)"],
      tbr_receipt: ["TBR RECEIPT","BOOKTOK TAX RECEIPT","RE-READ RECEIPT","PLOT TWIST RECEIPT"],
      library_card: ["CHECKED OUT","BOOKLAND RESIDENT","DUE BACK: NEVER","LIBRARY FLIRT CARD"],
      spice_scale: ["SPICE SCALE","CHEMISTRY CHECK","HEAT LEVELS"],
      delulu_meter: ["DELULU METER","REALITY CHECK","MANIFESTATION LEVELS"],
      door_tag: ["DO NOT DISTURB","READING IN PROGRESS","IN BOOKLAND","NOT AVAILABLE"],
      name_tag: ["HELLO, I AM","READER STATUS","INTROVERT MODE","MAIN CHARACTER"],
      book_review_card: ["BOOK REVIEW","5-STAR REPORT","THIS RUINED ME"],
      matchbook: ["IGNITE ME","BURN AFTER READING","STRIKE A MATCH"],
      candle_jar: ["SPELL CANDLE","PROTECTION CANDLE","LOVE WORK CANDLE"],
      elixir: ["LOVE ELIXIR","COVEN CHIC TONIC","BOOKLAND SERUM"],
      default: ["MAIN CHARACTER ENERGY","PLOT TWIST PENDING","SOFT LIFE LOADING","GREY AREA ONLY","LUXURY LOVE ONLY"]
    };

    const LABEL_SUBS = {
      romance: [
        "99% Delulu • 1% Regret",
        "Side effects: possessive energy",
        "Dosage: one more chapter",
        "Warning: may cause delulu",
        "Results: immediate butterflies",
        "Not FDA approved (but effective)"
      ],
      thriller: [
        "Case status: open",
        "Suspect: too charming",
        "Evidence: unread texts",
        "Plot twist pending",
        "Risk level: high",
        "Filed under: chaos"
      ],
      fantasy: [
        "Enchanted • do not dilute",
        "Moonlit dosage only",
        "Spellbound & sealed",
        "Summon at midnight",
        "Protected by wards"
      ],
      paranormal: [
        "Do not invite him in",
        "Blood moon approved",
        "Cloaked • keep secret",
        "Soul ties possible"
      ],
      luxe: [
        "Energy: expensive",
        "Luxury love only",
        "Polished & petty",
        "Keep it cute"
      ],
      horror: [
        "No sleep club",
        "Lights on recommended",
        "Do not read alone",
        "Creepy cozy level: high",
        "Plot twist: sinister"
      ]
    };

    // ---------- accents ----------
    const DEFAULT_ACCENTS_BY_PRODUCT = {
      iv_bag: "gold foil flecks + glitter dots",
      elixir: "gold foil flecks + glitter dots + tiny star sparkles",
      candle_jar: "tiny sparkles + glitter dots",
      tarot_pack: "ornate frame flourishes + tiny sparkles",
      book_review_card: "tiny star doodles + sparkle dots",
      book_stack: "tiny hearts + sparkle dots",
      tbr_receipt: "tiny star doodles + confetti dots",
      guest_check: "tiny sparkles + doodle marks",
      specimen_vial: "sparkly evidence glitter + tiny particles",
      evidence_tag: "tiny sparkle corners + barcode shine"
    };

    function describeProductKey(){
      const custom = (v("customProductTheme")||"").trim();
      if(custom) return custom;
      const k = v("productTheme");
      if(!k) return "";
      return PRODUCT_DESC[k] || `packaging-style sticker illustration with clean label panel`;
    }

    // ---------- quote banks ----------
    const MICRO_QUOTES = [
      "Final Chapter Energy","Kindle Confidential","TBR Supreme","Booktrovert Vibes",
      "Certified Delulu","Plot Twist Pending","Morals Optional","Grace With Teeth",
      "Stand On Business","Energy Expensive","Handle Correctly","Possessive Energy Only",
      "Soft But Savage","Pretty With Power","Reader In Charge","Do Not Disturb"
    ];

    // Templates based on your exact “whatever” phrasing (safe + editable):
    const TEMPLATE_QUOTES = [
      "I love “___” real bad.",
      "Me + “___” go together real bad.",
      "In my “___” era.",
      "DBE: “___” … 5 stars.",
      "This book ruined me… 5 stars.",
      "Remaining in Bookland until further notice.",
      "Ugly cry… “___”.",
      "STFUATTDLAGG — “___”."
    ];

    const TROPE_QUOTES = [
      // your requested trope list + extras (non-graphic)
      "Trope: Wealthy MMC",
      "Trope: Billionaire MMC",
      "Trope: Boss MMC",
      "Trope: Age Gap",
      "Trope: Protector MMC",
      "Trope: Bodyguard MMC",
      "Trope: Single Dad MMC",
      "Trope: Step-Daddy MMC (he steps up as ideal father figure)",
      "Trope: Reverse Harem / Why Choose",
      "Trope: MMF",
      "Trope: MFM",
      "Trope: MMFMM",
      "Trope: MMMF",
      "Trope: MMMMF",
      "Trope: Enemies to Lovers",
      "Trope: Forbidden Love",
      "Trope: Slow Burn",
      "Trope: He Falls First",
      "Trope: Only One Bed",
      "Trope: Fake Dating",
      "Trope: Forced Proximity",
      "Trope: Morally Grey MMC",
      "Trope: Touch Her & Die (non-graphic)",
      "Trope: Who Did This To You (protective)",
      "Trope: Found Family",
      "Trope: Second Chance"
    ];

    const QUOTE_BANKS = {
      // core
      general_urban_bookish: [
        "Booked, busy, unavailable.",
        "Respectfully, I’m in a chapter.",
        "If I reply late, blame the plot.",
        "Text me after the epilogue.",
        "Keep it cute, I’m reading.",
        "My peace got page numbers.",
        "Fictional standards only.",
        "Plot thickening, don’t call.",
        "Soft life, sharp tongue.",
        "Pretty, booked, and bothered? Never."
      ],
      tbr_kindle_booktok: [
        "My Kindle know my business.",
        "One more chapter is a lie.",
        "BookTok made me do it.",
        "I’m in my re-read era.",
        "My TBR got a mortgage.",
        "I DNF people too.",
        "Shelf control issues.",
        "Kindle history stays private."
      ],
      morally_gray: [
        "If he’s wrong, I’m worse.",
        "Charm is tactical.",
        "Mercy is optional.",
        "Soft voice. Hard consequences.",
        "Pretty. Petty. Precise.",
        "I play long games.",
        "Villain era, but make it cute."
      ],
      unhinged_mmc: [
        "Mine. No discussion.",
        "Obsessed is romantic.",
        "He doesn’t share.",
        "Protective looks good.",
        "Touch me & see (non-graphic).",
        "Red flags are decorative."
      ],
      street_lingo: [
        "Stand on business.",
        "Ten toes. No folding.",
        "Don’t play in my face.",
        "Clocked & noted.",
        "Say less.",
        "Keep it cute or keep it moving."
      ],
      tropes: TROPE_QUOTES,
      mood_iykyk: [
        ...TEMPLATE_QUOTES,
        "Mood: unbothered, booked.",
        "Mood: expensive peace.",
        "IYKYK.",
        "The girls that get it, get it.",
        "Audiobook on 1.5x.",
        "Narrator got me blushing.",
        "Slow burn, fast heartbeat.",
        "Tissues required.",
        "Crying but cute."
      ],

      // genre flavors
      urban_fiction: [
        "City-lit chemistry.",
        "Pressure make diamonds.",
        "Love loud. Move quiet.",
        "Hood luxe, soft hands.",
        "Ride-or-die reads."
      ],
      black_romance: [
        "Black love, big energy.",
        "Soft love, strong boundaries.",
        "Love me correctly.",
        "Peace first, passion second."
      ],
      dark_romance: [
        "Sweet… until midnight.",
        "Bad decisions, great chemistry.",
        "Tension got a grip on me.",
        "Danger looks good."
      ],
      black_paranormal: [
        "Ancestral power activated.",
        "Wards up, standards higher.",
        "Coven chic only.",
        "Moonlit & dangerous."
      ],
      thriller: [
        "Trust no one.",
        "Hidden in plain sight.",
        "Cold case energy.",
        "Plot twist pending."
      ],
      fantasy: [
        "Spellbound & sealed.",
        "Summon at midnight.",
        "Divine & dangerous.",
        "Fae rules, my terms."
      ],
      horror: [
        "No sleep club.",
        "Lights on, pages turned.",
        "Do not read alone.",
        "Creepy cozy reader.",
        "This book took my peace."
      ],
      soft_glam_reader: [
        "Soft glam, sharp mind.",
        "Lip gloss & literature.",
        "Cozy but don’t test me.",
        "Pretty pages only."
      ],
      bookish_luxe: [
        "Quiet luxury, loud standards.",
        "Glossy covers, expensive taste.",
        "Champagne chapters only.",
        "Polished & petty."
      ]
    };

    function customQuoteBank(){
      const raw = (v("customQuotes")||"").trim();
      if(!raw) return [];
      return raw.split(/\r?\n/).map(x=>x.trim()).filter(Boolean);
    }

    function selectedGenreKeys(){
      const map = [
        ["gUrbanFiction","urban_fiction"],
        ["gBlackRomance","black_romance"],
        ["gDarkRomance","dark_romance"],
        ["gBlackParanormal","black_paranormal"],
        ["gThriller","thriller"],
        ["gFantasy","fantasy"],
        ["gHorror","horror"],
        ["gSoftGlam","soft_glam_reader"],
        ["gBookishLuxe","bookish_luxe"]
      ];
      return map.filter(([id])=>c(id)).map(([,k])=>k);
    }

    function buildQuotePool(){
      const custom = customQuoteBank();
      if(custom.length) return custom;

      let pool = [];
      if(c("bGeneralUrbanBookish")) pool.push(...(QUOTE_BANKS.general_urban_bookish||[]));
      if(c("bTBRKindleBooktok")) pool.push(...(QUOTE_BANKS.tbr_kindle_booktok||[]));
      if(c("bMorallyGray")) pool.push(...(QUOTE_BANKS.morally_gray||[]));
      if(c("bUnhingedMMC")) pool.push(...(QUOTE_BANKS.unhinged_mmc||[]));
      if(c("bStreetLingo")) pool.push(...(QUOTE_BANKS.street_lingo||[]));
      if(c("bTropes")) pool.push(...(QUOTE_BANKS.tropes||[]));
      if(c("bMoodIYKYK")) pool.push(...(QUOTE_BANKS.mood_iykyk||[]));

      selectedGenreKeys().forEach(k=> pool.push(...(QUOTE_BANKS[k]||[])));

      const qm = v("quoteMode");
      if(qm === "micro" || qm === "any") pool.push(...MICRO_QUOTES);

      pool = uniq(pool);

      if(pool.length === 0){
        pool = uniq([...(QUOTE_BANKS.general_urban_bookish||[]), ...(QUOTE_BANKS.mood_iykyk||[]), ...MICRO_QUOTES]);
      }

      if(qm === "micro"){
        return uniq([...MICRO_QUOTES, ...TEMPLATE_QUOTES]);
      }

      return pool;
    }

    function chooseQuote(){
      const typed = (v("quote")||"").trim();
      if(typed) return typed;
      if(!c("useRandomQuote")) return "";
      const pool = buildQuotePool();
      return pool.length ? pick(pool) : "";
    }

    // ---------- strict cut-safe (stronger than before) ----------
    function cutSafeText(){
      if(!c("cutSafeMode")) return "";
      return [
        "Cut-safe die-cut requirement: one continuous closed silhouette outline around the ENTIRE design.",
        "ABSOLUTE RULE: every sparkle, glitter dot, foil fleck, smoke wisp, particle, shine pop, and glow must be INSIDE the silhouette boundary.",
        "No floating elements outside the border. No stray dots. No outside specks. No outside aura. No outer shadow.",
        "Any glow must hug the silhouette tightly and remain fully inside the die-cut outline.",
        "If any particles would cross the edge, remove them."
      ].join(" ");
    }
    function accentContainmentSuffix(){
      return c("cutSafeMode")
        ? "(ALL accents/particles/glow fully contained INSIDE the silhouette; zero elements outside the outline)"
        : "";
    }

    // ---------- typography + spice ----------
    function typographyRuleText(){
      if(v("typoRule") !== "on") return "";
      return "clear legible typography, centered composition, bold high-contrast text, no distorted letters";
    }
    function spiceAesthetic(){
      const s = Number(v("spiceLevel") || 1);
      if(s<=1) return "spice aesthetic: sweet tension, soft charm, cozy flirt energy";
      if(s===2) return "spice aesthetic: playful chemistry, cheeky tension, cute-but-bold";
      if(s===3) return "spice aesthetic: spicy vibes, bold flirting, possessive undertones (non-graphic)";
      if(s===4) return "spice aesthetic: dark romance heat, intense chemistry, edgy tension (non-graphic)";
      return "spice aesthetic: filthy talk energy, power tension, ruthless chemistry (non-graphic)";
    }

    // ---------- finish / style ----------
    function finishText(){
      const outline = (v("outline")==="bold_black") ? "thick bold outline" : "no outline";
      const border = (v("border")==="white") ? "clean white sticker offset border" : "no sticker border";
      const bgMode = v("bgMode");
      const bg =
        (bgMode==="transparent") ? "transparent background" :
        (bgMode==="solid_white") ? "solid white background" : "background not specified";

      const varKey = v("variation");
      const varText = varKey ? (VARIATIONS[varKey] || "") : "";

      return [
        outline, border, bg, varText,
        "bold shapes, punchy contrast",
        "crisp outlines, crisp edges, vector-like clarity",
        "high resolution",
        "no brand logos, no watermark"
      ].filter(Boolean).join(", ");
    }

    // ---------- harmony: horror -> red/black palette when blank ----------
    function paletteText(){
      const custom = (v("customPalette")||"").trim();
      const base = v("palette");
      let p = custom || base;

      if(!p && v("genreTone")==="horror"){
        p = pick(HORROR_PALETTES);
      }
      return p ? ("color palette: " + p + ".") : "";
    }

    function genreToneText(){
      const g = v("genreTone");
      return g ? ("genre tone: " + g.replaceAll("_"," ") + ".") : "";
    }

    function vibeText(){
      const vv = ((v("customVibe")||"").trim() || v("vibe") || "").trim();
      return vv ? ("vibe: " + vv + ".") : "";
    }

    function buildLabelTextBlock(stickerType, quote){
      if(c("blankMode")) return "No label text. No quote text. No typography.";
      const mode = v("labelMode");
      if(mode === "none") return "No label text.";

      const manualTitle = (v("titleText")||"").trim();
      const manualSub = (v("subtitleText")||"").trim();

      const pKey = v("productTheme") || "default";
      const titlePool = PRODUCT_LABEL_TITLE_BANK[pKey] || PRODUCT_LABEL_TITLE_BANK.default;
      const autoTitle = pick(titlePool);

      const subKey = subSetForGenre();
      const autoSub = pick(LABEL_SUBS[subKey] || LABEL_SUBS.romance);

      const title =
        (mode==="manual") ? manualTitle :
        (mode==="mixed") ? (manualTitle || autoTitle) :
        (mode==="quote_subtitle") ? autoTitle :
        autoTitle;

      const subtitle =
        (mode==="manual") ? manualSub :
        (mode==="mixed") ? (manualSub || autoSub) :
        (mode==="quote_subtitle") ? (quote || autoSub) :
        autoSub;

      if(mode==="manual" && !title && !subtitle) return "No label text.";
      return `Label text (packaging-style): title “${title}”${subtitle ? `, subtitle “${subtitle}”` : ""}.`;
    }

    function subSetForGenre(){
      const g = v("genreTone");
      if(g==="thriller") return "thriller";
      if(g==="fantasy") return "fantasy";
      if(g==="black_paranormal") return "paranormal";
      if(g==="horror") return "horror";
      if(g==="soft_glam_reader" || g==="bookish_luxe") return "luxe";
      return "romance";
    }

    function shouldIncludeQuoteLine(stickerType){
      const usage = v("quoteUsage");
      if(c("blankMode")) return false;
      if(usage === "never") return false;
      if(usage === "always") return true;
      if(stickerType === "icon_quote") return true;
      if(stickerType === "quote_only") return true;
      return false;
    }

    function mainSubjectText(){
      const customObj = (v("customMainObject")||"").trim();
      const product = describeProductKey();
      const stickerType = v("stickerType");

      if(stickerType === "packaging" || product){
        return `Main subject: ${product || "packaging-style sticker illustration with clean label panel"}` + (customObj ? `, featuring ${customObj}` : "") + ".";
      }

      if(customObj) return `Main subject: ${customObj}.`;
      return "Main subject: simple iconic bookish symbol.";
    }

    function accentsText(){
      const userAcc = (v("customAccents")||"").trim();
      const pKey = v("productTheme");
      const defaultAcc = DEFAULT_ACCENTS_BY_PRODUCT[pKey] || "";
      const combined = [userAcc, defaultAcc].filter(Boolean).join(" + ");
      if(!combined) return "";
      return `add accents: ${combined} ${accentContainmentSuffix()}.`;
    }

    // ---------- prompt assembly ----------
    function buildPromptSingle(){
      const stickerType = v("stickerType");
      const quote = chooseQuote();
      const typo = typographyRuleText();
      const cutSafe = cutSafeText();

      const safety = [
        "original design",
        "no trademarks",
        "no brand names",
        "no copyrighted characters",
        "no real book titles",
        "no celebrity likeness"
      ].join(", ");

      const blankLine = c("blankMode") ? "Blank sticker mode: absolutely no text anywhere." : "";

      const quoteLine = (quote && shouldIncludeQuoteLine(stickerType))
        ? `Quote text: “${quote}”.`
        : "";

      const labelBlock = buildLabelTextBlock(stickerType, quote);

      const labelPanelNote = (stickerType === "packaging" || v("productTheme") || (v("customProductTheme")||"").trim())
        ? "Include a clean label panel area for text, centered layout, readable hierarchy."
        : "";

      const productThemeText = ((v("customProductTheme")||"").trim())
        ? (v("customProductTheme")||"").trim()
        : (v("productTheme") ? v("productTheme").replaceAll("_"," ") : "None");

      return [
        "Create image:",
        finishText() + ".",
        cutSafe,
        paletteText(),
        genreToneText(),
        vibeText(),
        spiceAesthetic() + ".",
        "Product theme: " + productThemeText + ".",
        mainSubjectText(),
        accentsText(),
        typo ? ("Typography: " + typo + ".") : "",
        labelPanelNote,
        labelBlock,
        quoteLine,
        blankLine,
        safety + ".",
        "Clean commercial sticker clipart look, polished, readable, centered."
      ].filter(Boolean).join(" ");
    }

    function buildBundle(){
      const n = Math.max(1, Math.min(5, parseInt(v("count"),10) || 1));
      const out = [];
      for(let i=0;i<n;i++){
        out.push(`Prompt ${i+1}:\n${buildPromptSingle()}`);
      }

      // Negative prompt explicitly forbids outside particles
      const negative = [
        "photorealistic",
        "blurry",
        "low-res",
        "messy outline",
        "uneven line weight",
        "distorted letters",
        "unreadable text",
        "random extra words",
        "watermark",
        "signature",
        "brand logos",
        "copyrighted characters",
        "celebrity likeness",
        "background scene",
        "floating particles outside outline",
        "sparkles outside border",
        "glitter outside border",
        "foil flecks outside border",
        "outside aura",
        "outside glow",
        "outer drop shadow",
        "UI elements"
      ].join(", ");

      const notes =
`Export notes:
- Best: PNG
- Background: Transparent recommended
- Size: 2000–3000px

Cut-safe:
- ON = strict containment of ALL accents (sparkles/glitter/foil/particles/glow) INSIDE silhouette.
- If Ideogram still leaks sparkles outside, keep cut-safe ON and remove "extra sparkles" from custom accents.

Harmony:
- Horror + blank palette => auto red/black palettes.`;

      return { body: out.join("\n\n"), negative, notes };
    }

    function generate(){
      try{
        const { body, negative, notes } = buildBundle();
        setV("promptOut", body);
        setV("negOut", negative);
        setV("notesOut", notes);
        setStatus("Generated ✅");
        setTimeout(()=>setStatus("Ready"), 900);
      } catch(e){
        setV("promptOut", "❌ Generator error:\n" + (e?.message || e));
        setStatus("Error ❌");
        showToast("Error — check Prompt box");
      }
    }

    async function copyPrompt(){
      const text = (v("promptOut")||"").trim();
      if(!text){ showToast("Generate first"); return; }
      try{
        await navigator.clipboard.writeText(text);
        showToast("Copied");
      } catch{
        const ta = $("promptOut");
        ta.focus(); ta.select();
        document.execCommand("copy");
        showToast("Copied");
      }
    }

    // ---------- Hand-drawn preset ----------
    function applyHandDrawnPreset(){
      if(!c("handDrawnPreset")) return;
      setV("variation","hand_drawn");
      setV("outline","bold_black");
      setV("border","white");
      if(v("bgMode")==="none_specified") setV("bgMode","transparent");
      setV("typoRule","on");
    }

    // ---------- Randomize (still respects 1–2 banks max per section) ----------
    const CORE_BANK_IDS = ["bGeneralUrbanBookish","bTBRKindleBooktok","bMorallyGray","bUnhingedMMC","bStreetLingo","bTropes","bMoodIYKYK"];
    const GENRE_BANK_IDS = ["gUrbanFiction","gBlackRomance","gDarkRomance","gBlackParanormal","gThriller","gFantasy","gHorror","gSoftGlam","gBookishLuxe"];

    function uncheckAll(ids){ ids.forEach(id=>{ if($(id)) $(id).checked = false; }); }

    function pickOneOrTwo(ids){
      uncheckAll(ids);
      const pickCount = Math.random() < 0.55 ? 1 : 2;
      const shuffled = [...ids].sort(()=>Math.random()-0.5);
      shuffled.slice(0, pickCount).forEach(id=> setC(id,true));
    }

    const ALL_PRODUCTS = Object.keys(PRODUCT_DESC);

    function randomize(){
      setV("count", String(pick(["1","2","3"])));
      setV("stickerType", pick(["packaging","icon_quote","icon_only","quote_only"]));
      setC("cutSafeMode", true);

      // genre tone (includes horror)
      const g = pick(["urban_fiction","dark_romance","black_paranormal","black_romance","thriller","fantasy","horror","soft_glam_reader","bookish_luxe",""]);
      setV("genreTone", g);

      // variation
      const varPick = pick(["booktok_pop","bold_vector","luxury_editorial","neon_noir","noir_minimal","hand_doodle","hand_drawn","cute_clipart","vintage_label","kawaii_goth",""]);
      setV("variation", varPick);
      setC("handDrawnPreset", varPick==="hand_drawn");

      // vibe
      setV("vibe", pick(Array.from($("vibe").options).map(o=>o.value).filter(Boolean)));

      // product
      setV("productTheme", v("stickerType")==="packaging" ? pick(ALL_PRODUCTS) : (Math.random()<0.5 ? pick(ALL_PRODUCTS) : ""));

      // palette harmony
      if(g==="horror"){
        setV("palette", pick(["", ...HORROR_PALETTES]));
      } else {
        setV("palette", pick(["", ...PALETTES]));
      }

      // background
      setV("bgMode", pick(["transparent","solid_white","transparent"]));

      // spice
      setV("spiceLevel", pick(["1","2","3","4","5"]));

      // label
      setV("labelMode", v("stickerType")==="packaging" ? pick(["auto","mixed","none","quote_subtitle"]) : "none");

      // blank mode
      setC("blankMode", v("stickerType")==="icon_only" ? (Math.random()<0.3) : false);

      // quote banks (1–2 per section)
      pickOneOrTwo(CORE_BANK_IDS);
      if(Math.random()<0.6) pickOneOrTwo(GENRE_BANK_IDS); else uncheckAll(GENRE_BANK_IDS);

      setC("useRandomQuote", !c("blankMode"));
      setV("quote","");
      setV("titleText","");
      setV("subtitleText","");
      setV("customMainObject","");
      setV("customVibe","");
      setV("customPalette","");
      setV("customAccents","");
      setV("customProductTheme","");
      setV("customQuotes","");

      applyHandDrawnPreset();
      generate();
      showToast("Randomized ✅");
    }

    function clearAll(){
      setV("count","3");
      setV("stickerType","packaging");
      setV("genreTone","");
      setV("variation","");
      setC("handDrawnPreset", false);
      setV("vibe","");
      setV("productTheme","");
      setV("palette","");
      setV("bgMode","transparent");
      setV("border","white");
      setV("outline","bold_black");
      setV("spiceLevel","2");
      setV("typoRule","on");

      setC("blankMode", false);
      setC("cutSafeMode", true);
      setV("labelMode","auto");
      setC("useRandomQuote", true);
      setV("quoteUsage","smart");

      setV("quote","");
      setV("titleText","");
      setV("subtitleText","");
      setV("customMainObject","");
      setV("customVibe","");
      setV("customPalette","");
      setV("customAccents","");
      setV("customProductTheme","");
      setV("customQuotes","");

      uncheckAll(CORE_BANK_IDS);
      setC("bGeneralUrbanBookish", true);
      uncheckAll(GENRE_BANK_IDS);

      setV("promptOut","");
      setV("negOut","");
      setV("notesOut","");

      setStatus("Ready");
      showToast("Cleared");
    }

    // ---------- init ----------
    loadPalettes();

    $("generateBtn").addEventListener("click", ()=>{ applyHandDrawnPreset(); generate(); });
    $("copyBtn").addEventListener("click", copyPrompt);
    $("randomBtn").addEventListener("click", randomize);
    $("clearBtn").addEventListener("click", clearAll);

    $("handDrawnPreset").addEventListener("change", ()=>{
      if(c("handDrawnPreset")) applyHandDrawnPreset();
      generate();
    });

    window.addEventListener("load", ()=>{
      setC("cutSafeMode", true);
      setC("bGeneralUrbanBookish", true);
      generate();
    });
  </script>
</body>
</html>
